var ENTER_KEY=13;define("app",["jquery","backbone","alertify","autocomplete","bootstrap","backbone_syphon"],function(t,e,a,o){"use strict";jQuery=t;var n={action_url:"/assets/components/startpage/action.php",init:function(){t.ajaxSetup({error:function(t){var e=t.responseJSON;""!==e.message&&n.Message.failure(e.message)}}),a.defaults.maintainFocus=!1,o.defaults.EmptyMessage="",o.defaults.HttpMethod="POST",o.defaults.QueryArg="search",o.defaults.MinChars=2,o.defaults._Post=function(t){try{var e=[],a=JSON.parse(t);if(0===Object.keys(a).length)return"";for(var o=0;o<Object.keys(a.object).length;o++)e[e.length]={Value:a.object[o],Label:this._Highlight(a.object[o])};return e}catch(e){return t}},o.defaults._Select=function(e){e.hasAttribute("data-autocomplete-value")?this.Input.value=e.getAttribute("data-autocomplete-value"):this.Input.value=e.innerHTML,this.Input.setAttribute("data-autocomplete-old-value",this.Input.value),t(this.Input).parents("form").submit()},o.defaults.KeyboardMappings.Enter.Callback=function(t){if(-1!=this.DOMResults.getAttribute("class").indexOf("open")){var e=this.DOMResults.querySelector("li.active");null!==e&&(t.preventDefault(),this._Select(e),this.DOMResults.setAttribute("class","autocomplete"))}},o.defaults.KeyboardMappings.Enter.Event=0;var s=e.Router.extend({routes:{profile:"profile"},profile:function(){n.Modal.load("profile/get",{},function(){t('[data-toggle="tooltip"]').tooltip()})},clear:function(){this.old_browser||history.replaceState({},"",window.location.href.replace(/#.*$/,"")),n.Router.navigate("")}});n.Router=new s,t(document).on("ready",function(){e.history.start({root:document.location.pathname})}),n.$modal=t("#modal"),t(document).on("hide.bs.modal",function(){n.Router.clear()}),t(".modal").on("shown.bs.modal",function(){t(this).find("input:visible:first").focus()}),t(document).on("submit","form",function(a){var o=t(this);if(!o.hasClass("external")){a.preventDefault();var s=e.Syphon.serialize(o);s.action=o.attr("action"),o.find("input, button").attr("disabled",!0),t.ajax(n.action_url,{method:"post",data:s,dataType:"json",success:function(t){if(t.success&&!_.isEmpty(t.message)&&n.Message.success(t.message),!_.isEmpty(t.object.callback)){for(var e=t.object.callback.split("."),a=n,s=0;s<e.length;s++){if(void 0==a[e[s]])return!1;a=a[e[s]]}a(t.object)}o.find("input, button").attr("disabled",!1)},error:function(t){t=t.responseJSON,_.isEmpty(t.message)||n.Message.failure(t.message),o.find("input, button").attr("disabled",!1),o.find("input:visible:first").focus()}})}}),t('[data-toggle="tooltip"]').tooltip()},Modal:{load:function(e,a,o){_.isEmpty(a)&&(a={}),a.action=e,t.ajax(n.action_url,{method:"post",data:a,dataType:"json",success:function(t){n.$modal.find("#modal-title").text(_.isEmpty(t.object.title)?"":t.object.title),n.$modal.find("#modal-body").html(_.isEmpty(t.object.content)?"":t.object.content),_.isFunction(o)&&n.$modal.one("shown.bs.modal",function(){o(t)}),n.Modal.show()},error:function(t){t=t.responseJSON,_.isEmpty(t.message)||n.Message.failure(t.message),n.Router.clear()}})},show:function(){n.$modal.hasClass("show")||n.$modal.modal("show")},hide:function(){n.$modal.hasClass("show")&&n.$modal.modal("hide")}},Message:{success:function(t,e){""!==t&&a.notify(t,"success",e||5)},failure:function(t,e){""!==t&&a.notify(t,"failure",e||5)},info:function(t,e){""!==t&&a.notify(t,"info",e||5)},close:function(){a.dismissAll()},alert:function(e,o){a.alert(e).set({transition:"fade",closable:!1,movable:!1,pinnable:!1,modal:!0,onok:o,labels:{ok:"OK"}}).setHeader(""),t(".ajs-ok").addClass("btn btn-primary")},confirm:function(e,o,s){a.confirm(e).set({transition:"fade",closable:!1,movable:!1,pinnable:!1,modal:!0,onok:o,oncancel:s,onclose:function(){n.Router.clear()},labels:{ok:"OK",cancel:"web"===t('meta[name="page-context"]').attr("content")?"Отмена":"Cancel"}}).setHeader(""),t(".ajs-ok").addClass("btn btn-primary"),t(".ajs-cancel").addClass("btn btn-secondary")}},Profile:{callback:function(e){_.isEmpty(e.content)||t("header").find(".hybridauth").html(e.content)}}};return n.init(),requirejs(["app/links","app/counters"],function(){t(document).trigger("ready")}),n});